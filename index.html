<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Picture-Word Match</title>
  <style>
    /* --- ÁúÅÁï•„Å™„Åó„ÄÇÂÖÉCSS„Åù„ÅÆ„Åæ„Åæ --- */
    * { box-sizing: border-box; font-family: Arial, Helvetica, sans-serif; }
    body { margin: 0; background: #f0f8ff; }

    #container { display: flex; flex-direction: column; align-items: center; padding: 20px; }
    h1 { margin-bottom: 20px; }

    button { cursor: pointer; border: none; border-radius: 8px; padding: 10px 18px;
             font-size: 1rem; background: #2196f3; color: #fff; }

    #modeBtns { display: flex; gap: 20px; }

    #gameControls { display: flex; gap: 12px; margin-bottom: 16px;
                    justify-content: center; width: 100%; padding: 10px; flex-wrap: wrap; }
    #timer { font-weight: bold; font-size: 1.1rem; color: #d32f2f; }

    #gameArea { display: flex; width: 100%; max-width: 1200px; }
    #gameArea.horizontal { flex-wrap: nowrap; }

    .area { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; width: 50%; padding: 0 10px; }

    .img-card, .word-card { width: 100%; height: 100px; border-radius: 12px;
                            display: flex; align-items: center; justify-content: center;
                            user-select: none; touch-action: none; transition: transform .25s; }

    .img-card  { font-size: 2.2rem; background: #fff3e0; border: 3px solid #ffb74d; }
    .word-card { font-size: .9rem; background: #e3f2fd; border: 3px solid #64b5f6;
                 cursor: grab; padding: 6px; text-align: center; line-height: 1.15; }

    .matched { opacity: .35; cursor: default; }

    @keyframes flash { from { background: #c8e6c9; } to { background: #fff3e0; } }
    @keyframes shake { 10%,90%{transform:translateX(-4px)}
                       20%,80%{transform:translateX(4px)}
                       30%,50%,70%{transform:translateX(-4px)}
                       40%,60%{transform:translateX(4px)} }

    .correct-anim { animation: flash .3s ease-out; }
    .wrong-anim   { animation: shake .35s ease-in-out; }

    @media (max-width: 480px) {
      #gameArea { flex-wrap: wrap; }
      .area { width: 100%; max-width: 100%; grid-template-columns: repeat(2, 1fr); gap: 8px; }
      .img-card, .word-card { height: 80px; }
      .img-card { font-size: 1.8rem; }
      .word-card { font-size: .75rem; padding: 4px; }
    }
  </style>
</head>
<body>
<div id="container">

  <!-- ===== „Çπ„Çø„Éº„ÉàÁîªÈù¢ ===== -->
  <div id="startScreen">
    <h1>Picture-Word Match</h1>
    <div id="modeBtns">
      <button id="practiceBtn">Practice Mode</button>
      <button id="trialBtn">30-Set Trial Mode</button>
    </div>
  </div>

  <!-- ===== „Ç≤„Éº„É†ÁîªÈù¢ ===== -->
  <div id="gameScreen" style="display:none; width:100%; flex-direction:column; align-items:center;">
    <div id="gameControls">
      <select id="categorySelect"></select>
      <button id="startCategoryBtn">Start</button>
      <button id="backBtn">Back</button>
      <span id="timer" style="display:none; margin-left:20px; font-weight:bold; font-size:1.2rem; color:#d32f2f;"></span>
    </div>

    <div id="gameArea">
      <div id="imageArea" class="area"></div>
      <div id="wordArea"  class="area"></div>
    </div>
  </div>

</div>

<script>
/* ====================== ÂÖ±ÈÄöÂ§âÊï∞ ====================== */
let draggedWord = null;
let touchClone = null;
let timerInterval = null;

/* ====================== Èü≥Â£∞ÂÜçÁîü„É¶„Éº„ÉÜ„Ç£„É™„ÉÜ„Ç£ ====================== */
/* --- iOS„Åß„ÅÆ‚Äú„É≠„ÉÉ„ÇØ‚ÄùËß£Èô§Áî®„ÄÇÊúÄÂàù„ÅÆ„É¶„Éº„Ç∂„ÉºÊìç‰Ωú„Åß‰∏ÄÂ∫¶„Å†„ÅëÂÆüË°å --- */
function unlockAudio() {
  if (window._audioUnlocked) return;
  window._audioUnlocked = true;
  const dummy = new SpeechSynthesisUtterance('ready');
  dummy.lang = 'en-US';
  speechSynthesis.speak(dummy);
}
document.addEventListener('click', unlockAudio, {once:true});
document.addEventListener('touchstart', unlockAudio, {once:true});

/* --- ÂçòÁ¥î„ÅßÂêåÊúüÁöÑ„Å™ speak() --- */
function speak(text) {
  if (!('speechSynthesis' in window)) return;

  const utter = new SpeechSynthesisUtterance(text);
  utter.lang = 'en-US';

  /* Âà©Áî®ÂèØËÉΩ„Å™Ëã±Ë™ûÈü≥Â£∞„ÇíÂÑ™ÂÖà‰ΩøÁî®Ôºà‰æã: SamanthaÔºâ */
  const enVoice = speechSynthesis.getVoices().find(v =>
      v.lang && v.lang.startsWith('en') && /Samantha|Karen|Daniel|Fred/i.test(v.name));
  if (enVoice) utter.voice = enVoice;

  speechSynthesis.cancel();
  speechSynthesis.speak(utter);
}

/* ====================== ‰æøÂà©Èñ¢Êï∞ ====================== */
function addArticle(word) {
  const noArticle = [
    "bread","milk","rice","pants","shoes",
    "I sleep.","I run.","I drink juice.","I brush my teeth.","I eat sushi.",
    "I am happy.","I am sad.","I am tired.","I am hungry.","I am angry.",
    "red","blue","green","yellow","black","white","orange","purple","brown",
    "one","two","three","four","five","six","seven","eight","nine","ten","eleven","twelve",
    "sunny","rainy","windy","cloudy","snowy"
  ];
  if (noArticle.includes(word) || word.endsWith('s')) return word;
  return /^[aeiou]/i.test(word) ? `an ${word}` : `a ${word}`;
}

/* ====================== „Ç≤„Éº„É†„Éú„Éº„ÉâÊßãÁØâ ====================== */
function buildBoard(mode) {
  const imageArea = document.getElementById('imageArea');
  const wordArea  = document.getElementById('wordArea');
  imageArea.innerHTML = '';
  wordArea.innerHTML  = '';

  const allWordsByCat = {
    Food: ["apple","bread","milk","rice","egg","apples","eggs"],
    Animals: ["dog","cat","bird","elephant","dogs","cats","birds","elephants"],
    School: ["book","pen","pencil","chair","bag","books","pens","pencils","chairs","bags"],
    Family: ["mother","father","sister","brother","grandpa"],
    Clothes: ["shirt","shirts","pants","shoes","coat","coats","hat","hats"],
    Colors: ["red","blue","green","yellow","black","white","orange","purple","brown"],
    Numbers: ["one","two","three","four","five","six","seven","eight","nine","ten","eleven","twelve"],
    Weather: ["sunny","rainy","windy","cloudy","snowy"],
    Actions: ["I sleep.","I run.","I drink juice.","I brush my teeth.","I eat sushi."],
    Feelings: ["I am happy.","I am sad.","I am tired.","I am hungry.","I am angry."]
  };

  const allWords = Object.values(allWordsByCat).flat();
  const selected  = mode === 'trial'
      ? allWords.sort(()=>0.5-Math.random()).slice(0,30)
      : allWordsByCat[document.getElementById('categorySelect').value];

  /* --- ÁîªÂÉèÂÅ¥ÔºàÁµµÊñáÂ≠ó„Ç´„Éº„ÉâÔºâ --- */
  selected.sort(()=>0.5-Math.random()).forEach(word=>{
    const img = document.createElement('div');
    img.className = 'img-card';
    const emoji = {
      apple:"üçé",apples:"üçéüçé",bread:"üçû",milk:"ü•õ",rice:"üçö",egg:"ü•ö",eggs:"ü•öü•ö",
      dog:"üê∂",dogs:"üê∂üê∂",cat:"üê±",cats:"üê±üê±",bird:"üê¶",birds:"üê¶üê¶",elephant:"üêò",elephants:"üêòüêò",
      book:"üìï",books:"üìïüìï",pen:"üñäÔ∏è",pens:"üñäÔ∏èüñäÔ∏è",pencil:"‚úèÔ∏è",pencils:"‚úèÔ∏è‚úèÔ∏è",chair:"ü™ë",chairs:"ü™ëü™ë",bag:"üéí",bags:"üéíüéí",
      mother:"üë©",father:"üë®",sister:"üëß",brother:"üë¶",grandpa:"üë¥",
      shirt:"üëï",shirts:"üëïüëï",pants:"üëñ",shoes:"üëüüëü",coat:"üß•",coats:"üß•üß•",hat:"üé©",hats:"üé©üé©",
      red:"üü•",blue:"üü¶",green:"üü©",yellow:"üü®",black:"‚¨õ",white:"‚¨ú",orange:"üüß",purple:"üü™",brown:"üü´",
      one:"1Ô∏è‚É£",two:"2Ô∏è‚É£",three:"3Ô∏è‚É£",four:"4Ô∏è‚É£",five:"5Ô∏è‚É£",six:"6Ô∏è‚É£",seven:"7Ô∏è‚É£",eight:"8Ô∏è‚É£",nine:"9Ô∏è‚É£",ten:"üîü",eleven:"1Ô∏è‚É£1Ô∏è‚É£",twelve:"1Ô∏è‚É£2Ô∏è‚É£",
      sunny:"‚òÄÔ∏è",rainy:"üåßÔ∏è",windy:"üå¨Ô∏è",cloudy:"‚òÅÔ∏è",snowy:"‚ùÑÔ∏è",
      "I sleep.":"üò¥","I run.":"üèÉ","I drink juice.":"üßÉ","I brush my teeth.":"ü™•ü¶∑","I eat sushi.":"üç£ü•¢",
      "I am happy.":"üòä","I am sad.":"üò¢","I am tired.":"ü•±","I am hungry.":"ü§§","I am angry.":"üò†"
    };
    img.textContent = emoji[word] || word;
    img.dataset.word = word;
    img.addEventListener('dragover', e=>e.preventDefault());
    img.addEventListener('drop', handleDrop);
    imageArea.appendChild(img);
  });

  /* --- ÂçòË™ûÂÅ¥Ôºà„Éâ„É©„ÉÉ„Ç∞„Ç´„Éº„ÉâÔºâ --- */
  selected.sort(()=>0.5-Math.random()).forEach(word=>{
    const card = document.createElement('div');
    card.className = 'word-card';
    card.textContent = addArticle(word);
    card.dataset.word = word;
    card.draggable = true;

    /* „Éû„Ç¶„ÇπÂêë„Åë */
    card.addEventListener('dragstart', e=>{
      draggedWord = word;
      speak(addArticle(word));
    });
    wordArea.appendChild(card);
  });
}

/* ====================== „Éâ„É≠„ÉÉ„ÉóÂá¶ÁêÜ ====================== */
function handleDrop(e) {
  const target = e.currentTarget;
  if (target.dataset.word === draggedWord) {
    target.classList.add('matched','correct-anim');
    const match = document.querySelector(`.word-card[data-word="${draggedWord}"]`);
    if (match) match.classList.add('matched','correct-anim');

    setTimeout(()=>{ target.style.display='none'; match && (match.style.display='none'); },200);

    /* „Çø„Ç§„É†Ë®àÊ∏¨ÁµÇ‰∫ÜÂà§ÂÆöÔºàTrial „É¢„Éº„ÉâÔºâ */
    if (document.getElementById('timer').style.display==='inline') {
      const remaining = document.querySelectorAll('.img-card:not([style*="display: none"])').length;
      if (!remaining) {
        clearInterval(timerInterval);
        const sec = document.getElementById('timer').textContent.replace('Time: ','').replace('s','');
        speak(`${sec} seconds! Congratulations!`);
      }
    }
  } else {
    target.classList.add('wrong-anim');
    setTimeout(()=>target.classList.remove('wrong-anim'),350);
  }
}

/* ====================== „Çø„ÉÉ„ÉÅ„Éá„Éê„Ç§„ÇπÂêë„ÅëÁã¨Ëá™„Éâ„É©„ÉÉ„Ç∞ ====================== */
document.addEventListener('touchstart', e=>{
  const base = e.target.closest('.word-card');
  if (!base || base.classList.contains('matched')) return;

  draggedWord = base.dataset.word;
  speak(addArticle(draggedWord));

  touchClone = base.cloneNode(true);
  touchClone.style.position='absolute';
  touchClone.style.pointerEvents='none';
  touchClone.style.zIndex=1000;
  touchClone.style.opacity=0.7;
  touchClone.style.width=base.offsetWidth+'px';
  touchClone.style.height=base.offsetHeight+'px';
  touchClone.style.lineHeight=getComputedStyle(base).lineHeight;
  touchClone.style.fontSize=getComputedStyle(base).fontSize;
  touchClone.style.padding=getComputedStyle(base).padding;
  document.body.appendChild(touchClone);
});

document.addEventListener('touchmove', e=>{
  if (!touchClone || !e.touches.length) return;
  const t = e.touches[0];
  touchClone.style.left = (t.pageX - touchClone.offsetWidth/2)+'px';
  touchClone.style.top  = (t.pageY - touchClone.offsetHeight/2)+'px';
});

document.addEventListener('touchend', e=>{
  if (!touchClone) return;
  const dropEl = document.elementFromPoint(
      e.changedTouches[0].clientX, e.changedTouches[0].clientY);
  const img = dropEl && dropEl.closest('.img-card');
  if (img) handleDrop({currentTarget:img});   /* Áñë‰ººÁöÑ„Å´ drop ÂÆüË°å */
  touchClone.remove();
  touchClone = null;
});

/* ====================== „Ç≤„Éº„É†ÈñãÂßã„Éª„Çø„Ç§„Éû„Éº ====================== */
function startGame(mode) {
  document.getElementById('startScreen').style.display='none';
  const gameScreen = document.getElementById('gameScreen');
  gameScreen.style.display='flex';

  const catSel = document.getElementById('categorySelect');
  const startBtn= document.getElementById('startCategoryBtn');
  const timerEl = document.getElementById('timer');

  if (mode==='trial') {
    catSel.style.display='none';
    startBtn.style.display='none';
    timerEl.style.display='inline';
    startTimer();
    buildBoard('trial');
  } else {
    catSel.style.display='inline';
    startBtn.style.display='inline';
    timerEl.style.display='none';
  }
}

function startTimer() {
  const timerEl = document.getElementById('timer');
  const startTime = Date.now();
  timerInterval && clearInterval(timerInterval);
  timerInterval = setInterval(()=>{
    const sec = Math.floor((Date.now()-startTime)/1000);
    timerEl.textContent=`Time: ${sec}s`;
  },500);
}

/* ====================== ÂàùÊúüÂåñ ====================== */
document.addEventListener('DOMContentLoaded',()=>{
  /* --- „Éú„Çø„É≥ --- */
  document.getElementById('practiceBtn').addEventListener('click',()=>startGame('practice'));
  document.getElementById('trialBtn')   .addEventListener('click',()=>startGame('trial'));
  document.getElementById('backBtn')    .addEventListener('click',()=>{
    document.getElementById('gameScreen').style.display='none';
    document.getElementById('startScreen').style.display='block';
  });
  document.getElementById('startCategoryBtn').addEventListener('click', ()=>buildBoard('practice'));

  /* --- „Ç´„ÉÜ„Ç¥„É™„ÉºÈÅ∏ÊäûËÇ¢‰ΩúÊàê --- */
  const sel = document.getElementById('categorySelect');
  ["Food","Animals","School","Family","Clothes","Colors","Numbers","Weather","Actions","Feelings"]
    .forEach(cat=>{
      const opt = document.createElement('option');
      opt.value = opt.textContent = cat;
      sel.appendChild(opt);
    });
});
</script>
</body>
</html>
